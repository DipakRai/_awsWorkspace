S3--->EC2--->EBS--->ELB---->ECS


####################### AWS Identity and Access Management (IAM) #############################
Q. What are federated users?
Ans. Externally authenticated users (Google, Facebook)

Q. What do you mean by AWS provides very granular control?
Ans. 
	>to perform a single action
	>on a specific AWS resource
	>from specific IP address
	>during specific time window

Q. What is a group in IAM?
Ans. A collection of users.

Q. What is a policy?
Ans. A Policy is a JSON document with one or more permissions. It can have either "allow" or "deny" effects.

Q. How can you give permissions to a user?
Ans. 
	>By adding the user to a group which has the required permissions
	>By attaching existing policies directly

####### Managed, Customer Managed, Inline Policies #######################

Managed policies are of 2 types:
	>AWS managed
	>Customer managed
>Inline policy can be added to both user and groups

>>Accessing profile and other details through command line:
	$aws connfigure. 
	***Remember the above way is not a good way. Since aws credentials are stored in EC2 instance to which you have logged in through CLI
>>A better way to access AWS services through another AWS service is by creating and attaching roles to services.

Q. You have to provide permission to an EC2 instance to talk through AWS S3 buckets or any other service. How can you do it as an AWS architect?
Ans. By creating a role through IAM with permission to talk to the services it has to. And then assign the role to the EC2 instance. This is created automatically when using the 'AWS Management Console'. From CLI or API:
	>CreateInstanceProfile has to be used


Q. What is an instance profile in AWS? Which service does it belong to?
Ans. A container is automatically created when you create a role through IAM. This container is known as an instance profile.

Q. What are roles in IAM AWS?
Ans. IAM roles are a secure way to grant permissions to entities that you trust. Examples of entities include the following:
	
	>IAM user in another account
	>Application code running on an EC2 instance that needs to perform actions on AWS resources
	>An AWS service that needs to act on resources in your account to provide its features
	>Users from a corporate directory who use identity federation with SAML
	>IAM roles issue keys that are valid for short durations, making them a more secure way to grant access.


##########IAM Scenarios############
Q. You are the only user in your account. Which user should you use?
Ans. IAM user. Never use the 'root' user since this is the user with which you created an AWS account usign your email id and pwd. This 'root' user is used to delete the account itself.

Q. Your team needs access to your AWS account and there is no other identity mechanism. How do you handle this?
Ans. Create IAM users for team members and assign roles to each of the users.

Q. A user in one AWS account wants access to another AWS account. What should be done?
Ans. Create an IAM role for the user. This role only has permissions to perform certain actions through a call to AWS Security Token Service's (STS) AssumeRoleAPI for the 'role' that you created.

############IAM Federation Roles ########################################################
Q. What is Web Identity Federation?
Ans. It's about authenticating users with OpenID authentications, like Facebook, Google. AWS provides AWS Cognito which integrates with Facebook, Google or other OpenID Connect compatible ID providers.
Steps to do that:
	>Configure role to use Web Identity as trusted entity
	>The authentication tokens can be exchanged using STS AssumeRoleWithWebIdentity API

>Remember:
	>Identity based policies are always attached to an IAM user, group or role
	>Resource based policies and ACLs are always attached to a resource:S3 buckets, AWS SQS queues, and AWS KMS keys

Users
1. Root User
2. IAM User

#iam user
rajani_dev
Navya#09

#regions and zones
challenges
1 high latency
2 low availability
3 by having a region country specific it is also possible for an enterprise to adhere to govt regulations with respect to the 
data storage

AWS Services
Regional (EC2)
Global (IAM)

An availability zone is an isolated location in a Region
Each region has two AZs (minimum)

##EC2 instances
Elastic Compute Cloud

Virtual servers are rented for deployment of applications. These virtual servers are called EC2 instances.
EC2 services: service used to create (provision) EC2 instances
Features:
> create and manage lifecycle of EC2 instances
> load balancing and auto scaling of for multiple instances
> attach storage (& network storage) to your EC2 instances
> manage network connectivity for an EC2 instance

TODO 1: Set up EC2 instances as HTTP Servers/lifecycle of instances (start/stop instances)/connect EC2 Instance Connect to SSH into EC2 instance
TODO 2: Distribute Load With Load Balancers

Setting up an EC2 instance:
You have to select an  Amazon Machine Image: An AMI is a template that contains the software configuration (operating system, application server, and applications) required to launch your instance. You can select an AMI provided by AWS, our user community, or the AWS Marketplace; or you can select one of your own AMIs.


After you have made a choice of an AMI (in this case, Amazon Linux 2) I need to choose an "Instance Type" of the AMI.
There are primarily below instance type:
a. General Purpose
b. Compute Optimized
c. GPU instances (Graphics intensive)
d. Memory Optimized (Mem Caches, Distributed Caches)
e. Storage Optimized

Security Group:
A security group is a set of firewall rules that control the traffic for your instance. On this page, you can add rules to allow specific traffic to reach your instance. For example, if you want to set up a web server and allow Internet traffic to reach your instance, add rules that allow unrestricted access to the HTTP and HTTPS ports.

t2.micro
=> t:instance family;
=> micro:proportionate to CPU,GPU power

############EC2 Hands On:Setting up a HTTP Server##########################
$sudo su
$yum update -y
$yum install httpd -y
$systemctl start httpd
$systemctl enable httpd

###########Instance Metadata Service and Dynamic Data#################
How to get details of an EC2 instance from inside an EC2 instance:
>AMI ID>storage devices>DNS hostname>instance id>instance type>security groups>IP addresses
>>curl http://169.254.169.254/latest/meta-data : url to get details about the ec2 instance
>>curl http://169.254.169.254/latest/meta-data/ami-id : To know parameter specific details

###########Dynamic Data Service##################
Get dynamic information about an EC2 instance
URL:http://169.254.169.254/latest/dynamic
o/p:instance-identity/

>>curl http://169.254.169.254/latest/dynamic/instance-identity
o/p: 
rsa2048
pkcs7
signature
document

#IP:169.254.169.254 : this is the IP for the metadata
>>curl http://169.254.169.254/latest/dynamic/instance-identity/document

o/p: 
{
  "accountId" : "074535694428",
  "architecture" : "x86_64",
  "availabilityZone" : "ap-south-1a",
  "billingProducts" : null,
  "devpayProductCodes" : null,
  "marketplaceProductCodes" : null,
  "imageId" : "ami-0447a12f28fddb066",
  "instanceId" : "i-0776f5f535b6b6e6f",
  "instanceType" : "t2.micro",
  "kernelId" : null,
  "pendingTime" : "2020-06-20T17:46:33Z",
  "privateIp" : "172.31.37.176",
  "ramdiskId" : null,
  "region" : "ap-south-1",
  "version" : "2017-09-30"
}

############Security Groups######################
Defense In Depth: Having multiple layers of security
Configuring a security group -----> also implies configuring rules for that security group
>If there are no roles configured, no outbound/inbound traffic is allowed. This is known as DEFAULT DENY.
>in security configure only "allow rules" can be configured
>separate rules can be configured for inbound and outbound traffic
>on the EC2 instance: inbound rules : allow traffic from a load balancer
>outbound rules: traffic/requests or connections to a database
>you can configure separate rules for both inbound and outbound
>a max of 5 security groups can be configured to any of the resources
>add/delete security group to an EC2 instance at any time
>no need to restart the EC2 instance:changes immediately effective
>Traffic NOT explicitly allowed by the security group will not reach the EC2 instance
Security groups are stateful: 
	>if an outgoing request is allowed, then an incoming response for it is automatically allowed
	>if an incoming request is allowed, an outgoing response for it is automatically allowed


####EC2 IP Addresses
> Public IP addresses are internet addressable
> Private IP addresses are internal to a coporate network
> Two resources cannot have same public IP addresses
> 2 different corporate networks can have resources with same private IP address
> All EC2 instances are assigned private IP addresses
> Creation of public IP addresses can be enabled for EC2 instances in public subnet (check this statement later)
> On stopping an EC2 instance, public IP address is lost


####Public IP Address: 13.126.37.105: this always changes if an EC2 instance is stopped or started
####Private IP Address: 172.31.37.176: this never changes for an EC2 instance

###Elastic IP Addresses
Q. How do we handle the public IP address changing everytime, i.e. having a constant public IP address for an EC2 instance?
Ans. Elastic IP address.

> Elastic IP can be switched onto another EC2 instance within the same region
> Elastic IP remains attached even if you stop the instance. You have to manually detach it.
> You will be charged for an elastic IP address (check this too)


###Points To Remember
> You can change the instance type of an EC2 instance after stopping it
>An EC2 instance should be deployed across AZs to ensure redundancy
>> Following parameters are important for choosing an instance:
	>core count
	>memory size
	>storage size and type
	>network performance
	>CPU technologies

What are the different Amazon EC2 families?
	> Storage-Optimized: High I/Ops at low cost
	> Accelerated Computing: GPU intensive workloads (ML,3D)
	> Memory Optmized: High Performance DBs, In-Memory DBs
	> Compute Optimized: High performance computing, data lakes, network appliances
	> General Purpose: Balanced workloads
> GiB: scale of 2 rather than scale of 10
> AMIs: Are ISO files to spin up the EC2 instance. 
> An AMI is a template for the root volume for the instance (OS, AS, apps)
> Launch permissions

> AMIs differ from region to region

######Lifecycle of an EC2 instance:
launched--->pending--->running--->stopping---->stopped----->shutting-down---->terminated
> On termination, all data about the EC2 instance is lost. So a back up is important, i.e. actual data.
##How to know the data about the instances?
http://169.254.169.254/latest/user-data
http://169.254.169.254/latest/meta-data

####EC2 purchasing options?
>On Demand Instances (Pay by the hour)
>Reserved Instances (1 year-3 year terms, always available)
>Scheduled Instances (Purchase instances are always available on the specified recurring schedule, for a 1 year term)
>Spot instances (Bid on unused instances, which can run as long as they are available and your bid is above the Spot price)
	> example: in big data scenario, where data is across multiple nodes. and only the worker nodes can be put at
		    spot instances
	> these are not meant for mission critical applications
> Dedicated Instances (Pay, by the hour, for instances that run on single tenant hardware)
> Dedicated Hosts (Pay for a physical host that is fully dedicated to running your instances)


#####Simplify EC2 HTTP Server Setup: Creating an EC2 instance and setting up HTTP Server
Steps:
>Userdata
>Launch Template
>Custom AMI image

##Bootstrapping with Userdata
<!--script to be executed begins here:-->
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
curl -s http://169.254.169.254/latest/dynamic/instance-identity/document > /var/www/html/index.html
<!--script to be executed ends here: -->

Bootstrapping: Installing OS patches or software when an EC2 instance is launched

>In EC2 , you can configure userdata to bootstrap
>userdata can be looked up at http://169.254.169.254/latest/user-data/
> to re-configure a userdata we must stop the EC2 instance
> using userdata at launch of EC2 instances increases boot up time

####Launch Templates
Q. How to avoid specifying all the EC2 instance details (AMI ID, instance type,network settings) every time you launch an instance?
Ans. Create a 'Launch Template'.

Q. How to customize an AMI?
Ans. Since using 'userdata' at launch of an EC2 instance increases boot up time, creating customized AMIs with OS patches and software pre-installed is a better option.
> Advantage of using a customized AMI:
	> no need to worry about installing s/w while launching an EC2 instance
	> faster launching of EC2 instance

Q. What is an AMI?
Ans. contains OS/sw details There are 3 AMI sources:
	> Provided by AWS
	> AWS Market Place: Online store for customized AMIs
	> Customized AMIs: customized AMI created by you
#AMIs contain:
	> root volume block storage (this contains OS and applications)
	> Block device mappings for non-root volumes
	> AMIs can be configured for launch permissions thereby controlling access to them
	> To share an AMI I need to add account numbers of other AWS accounts
	> AMIs are stored in AS3 based on regions
	> AMIs must be backed up in multiple regions as a BCP plan

Q. I have an AMI in the Mumbai region and want to launch an instance using the AMI in Tokyo region. How do I do that?
Ans. Copy the AMI from Mumbai region to Tokyo region first. Then, launch the EC2 instance using that AMI.

Q. If I want to use a particular AMI and then create it into Mumbai a different AZ within that region. How do I do that?
Ans. While creating the instance there is an option to select 'Subnet' under 'Configure Instance Details'. This allows to create the instance in any other AZ within that region.

###########EC2 Security Key Pairs################
>A Key Pair: a public key that AWS stores, a private key file that user stores
Q. You are not able to connect to your EC2 instance via SSH client>
Ans. File permissions on the .pem file might need to be reviewed. It can't be too open for all. Instead change it to as below:
$chmod 400 ec2-default.pem

Q. What is the default user for SSH connection to EC2 instance?
Ans. ssh -i ec2-default.pem ec2-user@ec2-13-233-214-167.ap-south-1.compute.amazonaws.com


> EC2 uses public key cryptography for protecting login credentials
> Key-Pair: public key and a private key
	> Public key is stored in an EC2 instance
	> Private key is stored by customer
#####Connecting to EC2 (instances) troubleshooting
Q. I am not able to use the private key while trying to connect to an EC2 instance. How to troubleshoot?
Ans. Change permissions to 0400 (chmod 400 /path/my-key-pair.pem)
> For windows machine, and admin password is also required besides private key
> Security Group should allow inbound SSH (Linux:22) or RDP(Windows:3389) access
> For connecting to EC2 instance we must use its public DNS or the public IP
Q. Both Public DNS and Public IP can be used to connect to an EC2 instance? True or False.
Ans. True.
> Best practice for the EC2 instances is always to terminate them if not being used rather than just stopping them. Because each of the instance does occupy the EBS (Elastic Block Store) for which you can be charged.

Q. You want to identify all instances belonging to a project, to an environment or to a specific billing type. How do you do it?
Ans. Add Tags. Example: Project-A, Environment-Dev

Q. You want to change instance type. How do you do it?
Ans. You have to first stop the instance.

Q. You don't want the EC2 instance to be automatically terminated. How do you do that?
Ans. For an EC2 instance goto Instance Settings ---> Change Termination Protection. Remember, EC2 termination is not effective for terminations from:
	a. Auto Scaling Groups (ASG)
	b. Spot Instances
	c. OS shutdown
Q. How do you update the EC2 instance to a new AMI updated with the latest patches?
Ans. No. You can't update the AMI for a running EC2 instance. You have to relaunch a new instance with an updated AMI.

Q. How do you create EC2 instances based on on-premise Virtual Machine (VM) images?
Ans. Use VM Import/Export to use on premise VM images.

Q. Can we change the security group on an EC2 instance while it is running?
Ans. Yes. It can be done at any point of time. Both at launch and runtime. And they are immediayely effective.

Q. You are getting a timeout while accessing an EC2 instance?
Ans. Below:
	a. Security group (inbound rule) is whether allowing the connection (port:80 for website, port:22 for ssh, port:443 for https, port:3389 			for windows)
Q. You are installing a lot of software using user data slowing down instance launch. How to make it faster?
Ans. Create an AMI from the EC2 instance and use it for launching new instances.

Q. I h've stopped my EC2 instance . Will I be billed for it?
Ans. ZERO charge for a stopped instance. But you have to pay for the storage unless you have detached the storage from the EC2 instance.


##########EC2 instances and Regions/AZ################
>A private network is by default created for every region.
> Different regions have different subnets = different AZs in that region
> While creating an EC2 instance in the 'Configure Instance Details' tab you get an option to choose a 'subnet'. This subnet represents one of the AZs in the region of your choice.

###Recap for EC2 instance##########3
Q. What is an AMI?
Ans. It contains:
	> what OS I need
	> what s/w I need
	> AMI helps in reducing the boot time and improving security by creating customized hardened AMIs
	> AMI is region specific
	> If an AMI is required in another region then the same has to be copied into that region
	> AMI has to be backed up in multiple regions
	> AMIs can be shared with other AWS accounts
Q. What are EC2 instance types?
Ans. EC2 instance types are
	> optimized combination of compute (CPU, GPU), memory, disk (storage) and networking for specific workloads

###########Security Groups Recap###############
Q. What are security groups?
Ans. Security groups are:
	> virtual firewall to control incoming/outgoing traffic to/from AWS resources (EC2 instances, databases etc)
	> It works as 'Default Deny'
	> Separate 'allow' rules are there for inbound/outbound traffic
	> Stateful (if an inbound traffic is allowed for a particular request then the outbound traffic is also allowed for that particular request 		  or if an outbound traffic is allowed for a particular request then the inbound traffic is automatically allowed for that particular 		  request)
	> Immediately effective (rules can be updated without downtime)

Q. What are key pairs in Security Group?
Ans. Public Key Cryptography (Key pairs, private and public) are used to protect EC2 instances
	>Private key with write permissions (chmod 400) to connect to an EC2 instance
	>For Windows EC2 instance you need an 'Admin' password also
	>To allow access to an EC2 instance security group should allow SSH (22) or RDP (3389:Windows instance) to connect to

Q. What is Instance Metadata service?
Ans. It helps to get details of an EC2 instance from inside an (after connecting to) EC2 instance.
	>http://169.254.169.254/latest/meta-data

Q. What is Userdata?
Ans. It is used for bootstrapping. To install OS patches or software when an EC2 instance is launched

Q. What is Elastic IP address?
Ans. The public IP address of an EC2 instance would change on stopping/starting an EC2 instance. To avoid this we have an Elastic IP address. This address gives a static public IP address. This is billable only if EC2 instance attached with it is stopped or the elastic IP address is not at all attached with any running EC2 instance.

Q. What is a Launch Template?
Ans. A Launch Template is a a pre-configured template (AMI ID, instance type, network settings) to simplify the creation of the EC2 instance.


##########-Reducing Billing Costs-################
> Set billing alerts
> monitor the billing dashboard
> stop resources when you are not using them
> https://aws.amazon.com/free/
> https://aws.amazon.com/pricing
Q. How to configure actual billing alert?
Ans. Either by 'Manage Billing Alerts' also known as 'Cloud Watch' or a new feature called 'Budget'
Q. What is CloudWatch?
Ans. It is a monitoring service and triggers alarms for something unexpected happens based on confgurations set by the user. AWS Budget is another way to do the same.

######### Getting started with AWS Elastic Load Balancing ##################
>Elastic Load balancer is an AWS service that would enable to distribute load among multiple EC2 instances. These EC2 instances in turn can be in one or more AZs in the same region.
> AWS ELB is a managed service. This means that AWS would ensure that an ELB once created would always be available and scalable.
> An AWS ELB can be either:
	> Public: Accessible over internet
	> Private: Accessible to internal AWS network
> An AWS ELB distributes load to only healthy EC2 instances. (Health check is performed by AWS ELB)
>A variety of load balancers are supported by AWS.

##Communication between two different systems
It is about protocols, Nabhu!
Application-Layer (Layer 7)------>HTTP/HTTPS/SMTP----->REST API/Emails
Transport-Layer (Layer 4)-------->TCP/TLS/UDP------>Ensures the 0s/1s are transferred properly. Relibility and Performance is ensured
Network Layer (Layer 3)--------->IP---------------> Bits and Bytes. Unreliable

Q. Give example of applications which directly talk at Network layer? (Hint: High performance apps)
Ans. Netflix

Transport Layer has below important, widely used protocols:
	>TCP (Transmission Control)
	>TLS (Trasnport Layer Security): Secure TCP
	>UDP (User Datagram Protocol):Performance/Reliability example video streaming apps


####3 types of elastic load balancers:
	>Classic Load Balancer (Layer 4 and Layer 7) 
		:an old generation balancer
		:supporting both Transport layer (layer 4:TCP/TLS) and Application layer (layer 7:HTTP/HTTPS) protocols
		:Not recommended by AWS since they realized having a single load balancer to manage loads on two layers may not be a very good idea.

Q. Why AWS doesn't recommend the Classic Load Balancer?
Ans.

So there are two load balancers primarily now:
> Application Load Balancer (Layer 7)
	~HTTP/HTTPS supported
	~supports advanced routing approaches like:
		>look up the request header/request path/request hostname and based on it the request can be routed to different destinations

> Network Load Balancer (Layer 4:Transport layer)
	>new gen load balancer
	>TCP/TLS and UDP

Remember: You can create a custom AMI with all the necessary hw+sw configurations. Then you can create a custom launch template using this custom AMI. And then you can keep creating EC2 instances using this custom launch template.

>Using the same security group for load balancers as EC2 instance would be a bad practice. So always create a new security group for Elastic Load Balancers

Q. If you want an EC2 instance which has just been detected unhealthy to complete its ongoing request processing, how do you do that?
Ans. By enabling and configuring the ELB parameter 'Enable Connection Draining'.

##########Application Load Balancer##############
>Most popular and frequently used ELB in AWS
>Supports WebSockets and HTTP/HTTPS (Layer 7)
>Supports all load balancer features (i.e. can look into the request header and do all kind of advanced routing algorithms)
>Supports auto scaling

****Remember AWS would take care of auto scaling of ELBs and NOT EC2 instances (i.e. something to be done through auto scaling group)
>ALB ELB can load balance between:
	>EC2 instances (AWS)
	>Containerized applications (Amazon ECS is a service to run docker based [container based] apps)
	>Web apps (IP Addresses)
	>Lambdas (serverless arch, though that is more with API gateways)
>Each target group can be associated with only one load balancer

Q. Healthy Threshold is the number of consecutive health checks successes required before considering an unhealthy target healthy (2-10). True or False.
Ans. True

Q. Unhealthy Threshold is the number of consecutive health check failures required before considering a target unhealthy (2-10). True or False.
Ans. True

Q. What are subnets?

Q. What are class A,B,C IP addresses?

Q. Ideally all traffic to EC2 instance should happen via ELB. How would you go about doing that?
Ans. Configuring via security group. This is achieved as below:
	>Load Balancer allows traffic from everywhere
	>EC2 Security Group ONLY allows traffic from ELB Security Group

Q. What is a listener?
Ans. A listener checks for connection requests using its configured protocol and port, and the load balancer uses the listener rules to route requests to targets. Each load balancer has:
	> a protocol
	> a port
	> a set of rules to route requests to targets

####Target Groups

Q. What are target groups?
Ans. It helps to group the EC2 instances to distribute the load amongst.
	> instances can be added/deleted from the group (dyamically?: yes)
	> it can be a set of EC2 instances
	> a lambda function (serverless architecture)
	> Or a set of IP addresses (Web apps)

Q. What is a deregistration delay?
Ans. It implies "how long should Elastic Load Balancer wait before de-registering a target". Load balancer would then stop routing new requests to a target when you unregister it. So a deregistration delay of 300 seconds means 'ELB would wait for 300 seconds by default to for in-flight (under processing)  requests to complete execution before de-registering a target. During this time, the state of the target is draining.'

Q. What is 'connection draining'?
Ans. It means the wait time before the target can be deregistered by the ELB.

Q. What is a slow start duration?
Ans. Time to warm up for the target before requests start coming in full flow to it. 'During this period, a newly registered target receives an increasing share of requests, until it reaches its fair share'.

Q. What are the two Load Balancing Algorithms for ELB?
Ans. Round Robbin and Least Outstanding Requests

Q. What is stickiness in ELB?
Ans. A 'sticky session' means a specific request from a specific user always goes to the specific EC2 instance. 'Stickiness' helps to achieve that.
This is implemented with the help of a cookie (cookie name:AWSELB).

Q. What is the protocol and port of 'Health Check'?
Ans. HTTP and 80

######Sample user data for microservice####################
#!/bin/bash
curl -s http://169.254.169.254/latest/dynamic/instance-identity/document > /var/www/html/index.html
mkdir /var/www/html/a
echo "Microservice A" > /var/www/html/a/test.html
######Sample user data ends for microservice##############

Q. One ELB can support multiple microservices. How?
Ans. By creating multiple target groups. Only Application Load Balancer supports mutliple target groups, unlike Classic Load Balancers. This is made possible through configuring multiple listeners.

Q. A set of rules for listeners are given. Few of the rules are repeated. Which rule would have a precedence finally?
Ans. The rule which comes at the last.

Q. Creating a customized AMI is better than using userdata to launch an EC2 instance. True or False.
Ans True. Since isntalling OS patches and software using userdata at launch of EC2 instances increases boot up time. Hence creating EC2 images (customizing your AMI) is a better option. This is also called as 'hardening of an image'.

############Listener Rules:Load Balancer#####################
>The following are the listener rules:
	> path
	> host
	> HTTP headers (Authorization header) and methods (POST,GET,etc)
	> Query Strings (/microservice?target=a,/microservice?target=b)
	> IP Address
Q. Host and IP address are two of the parameters based on which we can route a url? True or False.
Ans. True. (Application Load Balancer is the preferred load balancer for this). Refer:https://doc.amazonaws.cn/en_us/elastiloadbalancing/latets/application/introduction.html

###Main characteristics of ELastic Load Balancer ELB
	>highly decoupled architecture
	>load balancer can have multiple listeners (protocol + port combinations)
	>each listener can have multiple rules each routing to a target group based on request content

Q. Can a target (EC2 instance) be a part of multiple target groups. Yes or No.
Ans. Yes. But a target group can be a part of single ALB (application load balancer) only.

################Getting Started With Auto Scaling Group###############################
Q. What is the problem with Target Groups when it comes to scaling of load balance?
Ans. Target groups are configured with a static set of instances (i.e. instances created manually through launch template/custom AMI or directly). Hence cannot be scaled out and scaled in automatically. Thereby the need for ASG as below. (ASG auto creates EC2 instances)

>Scale Out: Increasing the number of instances
>Scale In: Removing instances

Q. What are the main characteristics of an Auto Scaling Group?
Ans.
	>Maintain configured number of instances (using periodic health checks); so if an instance goes down, ASG (Auto Scaling Group) launches a 		 replacement instance
	>Auto Scale to adjust to load (scale in and scale out based on auto scaling policies)
	>Can launch:
		>On-Demand Instances
		>Spot Instances
		>Both of the above
Remember:	Best Practice: Use Launch Template to create auto scaling groups as well


#####Points to remember:Auto Scaling Components
>Launch Configuration /Template
	>EC2 instance size and AMI

>Auto Scaling Group
	>Created by reference to Launch Configuration/Template
	>Min, Max and Desired Size of ASG
	>EC2 health checks are done by default. Optionally, we can enable ELB health checks
	>Auto scaling policy
		>this includes when and how to execute scaling
ASG helps us in the following use cases:
	>maintain current instance levels at all times (useful where load on the instances are always fixed)
	>scale manually (change min/max/desired manually)
	>schedule based scaling
	>demand based scaling (dynamic / automatic scaling)

Dynamic Scaling Policy Types
	>Target tracking scaling: Maintain CPU utilization at 70%
	>Simple Scaling: +5 ->if CPU utilization is > 80% and -3 if CPU utlization is < 60% (waits for cooldown period)
	>Step scaling: complex policies (warm up policy can be configured for each instance)
		> +1 if CPU utilization is betweenn 70%-80%
		> +3 if CPU utlization is between 80%-100%

###Two important parts for scaling policy:
	>CloudWatch alarm
	>Scaling action (+5 EC2 instances or -3 EC2 instances)
Q. How do you autscale ELB?
Ans. Using CloudWatch alarms

Q. I want to perform an action before an instance is added or removed from ASG (Auto Scaling Group). How do I do that?
Ans. LifecycleHook

Q. When a scale in happens, which instance in an ASG is terminated first by ASG?
Ans. ASG decides this based on a termination policy. The Default termination policy states that:
		> instances in an ASG are evenly distributed across AZs
		> terminate the older instance

Q. How do you prevent frequent scale up and scale down in ASG?
Ans. By configuring a cooldown period. Default is 300 seconds. This can be set to a higher value. You have to also align CloudWatch montioring interval with the cooldown period.

Note: Study of ASG Policy has been a little murky. And needs revision on my side before the AWS exam.

#####Network Load Balancer
>CLB works at layer 4 and layer 7
>ALB works at layer 7
>NLB works at layer 4

Q. Which load balancer can be assigned elastic IP addresses?
Ans. Network Load Balancer

Q. Lambda Apps can be load balanced using Network Load Balancers. True or False.
Ans. False

Main characteristics:
>Layer 4 (TCP,TLS,UDP)
>High performance
>Both static and elastic IP
>Can load balance between
	>EC2 instances
	>containerized apps (Amazon ECS)
	>Web apps(using IP addresses)

####################EC2 and ELB for Architects	
Q. What is called four 9s availability?
Ans. 
	99.99% (4 and half minutes downtime only)
	99.999% (26 seconds downtime only)	
Steps to achieve high availability:
>>>>have your instances behind ELB
>>>>deploy to multiple AZs
>>>>cross zone load balancing
>>>>deploy to multiple regions
>>>>configure proper health checks for EC2 and ELB health checks (for target tracker it is done by default through cloud watcher the moment the rule is configured)


Q. What is scalability?
Ans. 
	Would you be able to handle growth (users, traffic, data size) )without dipping your performance; and 
	Does the ability to serve growth increase proportionally with resources
Q. What are the different types of scaling?
Ans. Vertical and Horizantal

Q. Define vertical scaling?
Ans. Increasing the instance size is vertical scaling.
Example: t2.micro to t2.small to t2.large

Q. Define horizontal scaling?
Ans. Increase the number of instances rather than the size. Horizontal scaling is preferred over vertical scaling as:
	>vertical scaling has limits with respect to the size of the configuration
	>vertical scaling is expensive
	>horizontal scaling increasses availability since multiple instances offset the failing of one of the instances

Q. I want to go 'Distributed Loading'. I have to opt for Auto Scaling, ELB and ____?
Ans. Route53

#############Instance Families
>m family:General purpose
>t family:Burstable performance: accumulate CPU credits when inactive; suitable for situations with spikes like testing environment
>c family:Compute optimized: batch processing, high performance computing
>r family:memory optimized (RAM): Memory caches, in-memory databases and real time big data analytics
>i family:storage (I/O) optimized; NOSQL Ds and Data warehousing
>g family: GPU optimized
>f family:FPGA instances customizable field programmable gate arrays; massive parallel programming power like genomic data analytics, video processing,financial computing
>inf family:ML ASIC instances;image recognition,speech recognition,NLP

Q. What is the 'Unlimited Mode' in EC2 Burstable instance? Should we enable it by default?
Ans. No. Unlimited mode signifies 'spike beyond CPU credit at additional cost'. This should be enabled after good thought since a malicious activity at the instance can make the CPU usage shoot up sky high leading to huge costs before getting detected.
T2: unlimited mode=disabled (default)
T3: unlimited mode=enabled (default)

##############EC2 Tenancy#############33
>These are two types:
	>Shared (default)
		>single host machine has instances from multiple customers
	>Dedicated: this is again of two types:
		>Dedicated EC2 instances:
			>virtualized instances on hardware dedicated to one customer
			>no visibility into the h/w of the underlying host (you cannot access the sockets/cores directly: elaborate??)
			>billing is per instance
		>Dedicated EC2 Hosts
			> physicals servers dedicated to one customer
			> visibility into the h/w of underlying host (sockets and physical cores)
			> example includes: regulatory needs or server-bound software licenses like Windows Server, SQL Server
			> billing is per host
			> targeted instance placement
			> access to underlying hardware

#############EC2 Placement Groups#################
Q. Why do we need placement groups?
Ans. 
	>Sometimes I would need low latency connection between a group of instances. (instances on the same rack would have a faster connection 	 compared to instances on different racks). 
	>again instances where we need high availability (placing multiple instances in a group can be placed across multiple racks thereby 		 increasing availability)
Q. What are the types of EC2 placement groups?
Ans. 
	>Cluster (low latency network): you go for this when high n/w availability is paramount
	>Spread (avoid simultaneous failures): you go for this when availability (avoiding simultaneous failures of EC2 is important)
	>Partition (multiple partitions with low latency network;example : HDFS, Cassandra): low latency + high availability

Q. Select all the applicable criteria when an 'Insufficient Capacity Error' may take place.
Ans. 
	>New instances are added (OR)
	>More than one instance type is used (OR)
	>An instance in a placement group is stopped and started

Q. You are getting an "Insufficient capacity error" in the placement group. How can you address this?
Ans. 
	>Stop and start all instances in the placement group (OR)
	>Try to launch the placement group again

>Note:Instances may be migrated to a rack that has capacity for all the requested instances during the above addressal.
	
Q. Select the recommendations/best practice while launching placement groups.
Ans. 
	>Have only one instance type in a launch request AND
	>Launch all instances in a single launch request together

################Elastic Network Interface###############
Q. Elastic Network Interface is a logical networking component that represents a virtual network card. True or False.
Ans. True. An EC2 instance has a private/public IP addresses. This is possible through ENI. It supports both IPV4/IPV6

Q. An EC2 instance can have multiple private IP addresses. True or False.
Ans.  True. But as secondary.

Q. How many type of Elastic Network Interface are there?
Ans. Two:
	>eth0 : primary
	>eth1 : secondary

Q. I want my EC2 instance to be dual homed, i.e. the instance needs to act as if it is present in two different subnets in the same VPC. How is it possible?
Ans. Connecting the EC2 instance to secondary interface eth1.

Q. What is Hot Attach?
Ans. Hot attach is attaching ENI when EC2 instance is running

Q. What is Warm attach?
Ans. Warm attach is attaching ENI when EC2 instance is stopped.

Q. What is Cold Attach?
Ans. Cold attach is attaching ENI at the time of EC2 instance creation.

####Monitoring EC2 instances
>CloudWatch provides BASIC Free monitoring "every 5 mins" for all EC2 instance types
	>CPU utilization
	>Network In/Out
	>Disk Reads/Writes
	>CPU Credit Usage and Balance (For Burstable Instances)
	>Detailed Monitoring is billable and not enabled by default
Q. You can find out about how much memory is consumed through CloudWatch. True or False.
Ans. False. CloudWatch does not provide OS level metrics by default. You need to install an agent like "collectd" plug-in for the same

#####EC2 Pricing Models Overview##########
4 different models:
	>On Demand (spiky traffic apps can be hosted here)
	>Spot Instance (non-critical workload like batch jobs; cheapest; but no guarantee if it would be available)
	>Reserved Instance (1 or 3 years reservation)
	>Saving Plans (Committing a few dollars per hour)

Q. You are moving a batch program for the first time from on premises to cloud. What do you think would be the best pricing model to go for for an EC2 instance?
Ans. On Demand. Since we don't know about the runtime for this and we don't want it interrupted either

Q. As AWS architect you have recommended a very critical non-fault tolerant application to be deployed on an EC2 instance in the 'Spot Instance' pricing model. Is it a good or a bad decision?
Ans. A bad decision. AWS can withdraw a spot instance any moment with a '2 mins' notice. And the app would then be not available.

Q. Pricing is always a concern in your organisation. And you need to deploy an app over AWS EC2 instance but only for a few hours. Which pricing model instance would you opt for in this case as an AWS architect?
Ans. Spot Block. This allows to request EC2 spot instances only for a specific duration (1 0r 2 or ...6 hrs)

Q. How do you ensure that your application stops gracefully when hosted by an EC2 instance under Spot Instance pricing strategy?
Ans. This can be done in two steps:
	>Make the spot request 'persistent'
	>Set the 'Interruption Behaviour' for the instance as 'Stop' or 'Hibernate'


##################EC2 Reserved Instances#########################
>This reserves EC2 instances ahead of time
>3 types of reserved instances:
	>Standard
	>Convertible
	>Scheduled:
>3 types of payment models:
	>no upfront payment; monthly instalment
	>partial upfront;monthly instalment
	>all upfront
	>cost wise:earlier you pay more the discount
#EC2 Standard Reserved Instances
	>can switch between instance sizes but within the same family
	>can switch AZs
	>cannot change instance families,OS or tenancies (default or dedicated)
#EC2 Convertible Reserved Instances: more flexible than above
	>can switch between instance sizes and family
	>can switch AZs
	>can switch OS or tenancies (default or dedicated)
#EC2 Scheduled Reserved Instances
	>commitment:X hrs every month/week/day
	>available only for a few instance types in a few regions
	>Bill generation/batch generation programs
	
###EC2 Savings Plan
	2 types:
		>Compute Savings Plan (AWS compute platforms: EC2/Fargate/Lambda)
		>Instance Savings Plan restricted to specific region/specific instance family

Q. You have an application running on EC2. In future you may need to change it a containerised app and need to run it on Fargate. What kind of plan you would opt for?
Ans. Compute Savings Plan since it allow to switch amongst compute models/OS/tenancy/AZs

Remember:
Pricing Model		Usecases
--------------	       ------------
On Demand		Spiky Workloads
Spot			Cost Sensitive, Fault Tolerant, Non immediate workloads
Reserved		Constant workloads that run all time
Savings Plan		Constant workloads but with some flexibility
>>>refer https://www.ec2instances.info/

Q. Where can you find all the certificates in AWS for SSL/TSL?
Ans. In AWS Certificate manager.

TSL Termination (NLB):
Client---------------ELB-X.509-certificate/HTTPS-------------------ELB-------------HTTPS/TCP preferred---------------EC2 Instance

SSL Termination (CLB):
Client---------------ELB-X.509-certificate/HTTPS-------------------ELB-------------HTTP--------------------------EC2 Instance

#############Server Name Identification

Q. How do we handle a situation where there are multiple certifcates for multiple targets but a single load balancer?
Ans. Each listener in the ELB can be associated with multiple SSL certificates (one for each website). And then SNI can take care of it. Client indicates the host name being contacted to at the start of the interaction

Q. Where are logs from ELB are stored to? S3 or EBS?
Ans. S3

Q. Which header contains the client port details for traffic coming from the Network Load Balancer? X-Forwarded-Port or X-Forwarded-For or None of the above.
Ans. None of the above. N/w load balancer allows the EC2 instance to see all client headers as sent from the client. The Application Load Balancer does not. And the two headers mentioned are only applicable for Appliation Load Balancer.

!!!!!!!In28Minutes:Slide 82/83 : Important for recollection of all points with respect to load balancers

Load Balancer Security Scenarios:
>Protect ELB from web attacks - SQL injection/Cross Site Scripting---->Integrate with AWS WAF
>Protect web apps from DDoS attacks ------->Have the app behind ALB which by default protects from common DDoS attacks like SYN floods, UDP reflection attacks

################AWS Managed Services####################################
IAAS, PAAS, CAAS, FAAS

IAAS:
	>Only infra from cloud provider
	> aka "Lift and Shift"
	>Use Only EC2 instance to deploy your applications
	>BUT scalability/availability/upgrades/patches are all your headache
PAAS:
	> more inclusive than IAAS. Also takes care of the scalability/availability of the apps (example AWS Beanstalk)

CAAS: Container As a Service

FAAS: Function As A Service (Never worry about servers/deployments, etc. Servlerless:AWS Lambdas, API Gateways)

Some of the managed service by AWS:
>ELB
>Beanstalk: Run and manage Web Apps
>ECS: Elastic Container Service (Containers orchestration on AWS). In case of a microservice arch, with a lot of microservices running on different containers, the ECS comes in handy to manage, scale these containers
>Fargate:Serverless version of ECS
>EKS: Kubernetes is  a cloud neutral solution for container orchestration
>RDS: Relational Database Service supports wide variety of DBs


Q. What is AWS Beanstalk?
Ans. The simplest way to deploy/scale web apps in AWS. You pay only for AWS resources you provision. It has the below features:
	>Automatic Load Balancing
	>Auto scaling
	>Manage platform updates
	>App health monitoring
>Every app created in Beanstalk would have different environments. Namely,
	>Web Server environment
	>Worker environment
Key Concepts:
Q. What is an application in Elastic Bean Stalk?
Ans. It is a container for environments, versions and configuration
Q. What is an application version?
Ans. A specific version of deployable code (stored in S3)
Q. What is an Environment?
Ans. An application version deployed to AWS resources. You can have multiple environments running different application versions for the same application.
Q. What is an environment tier?
Ans. Worker tier (Batch apps) and web server tier (Web apps)
#Remember
>In AWS Elastic Bean Stalk you retain full control over the AWS resources
>Ideal for simple web apps
>can access server logs over S3
>not ideal for microservices
>auto apply of patches and platform updates
>Metrics are sent to Amazon CloudWatch
>Can configure SNS notifications based on health


##########Container Solution in AWS
#Cloud Neutral:
>AWS Elastic Kubernetes Service (EKS)
>EKS does not have a free tier
#AWS Specific
>AWS Elastic Container Service: management of servers/clusters is manual through configurations
>AWS Fargate: Serverless version of AWS ECS. You don't have to worry managing servers/clusters. We have to just write a set of functions to do the same. No free tier

##############Amazon ECS####################################
>A cluster of EC2 instances can be managed through AWS ECS
>The microservices to be deployed over these clusters should be a docker image which is configured to run on ECS
>fully managed service for container orchestration
>serverless flavour:AWS Fargate
> Use cases:
	>Microservices Architectures: Create containers for your microservices and orchestrate them using ECS or Fargate
	>Batch Processing: Run batch workloads on ECS using AWS Batch

##################Fargate####################################
Below are the ECS objects and how are they related:
>Container Definition:
	>>what is the image you want to use
	>>contains the definition of a container;
	>>how much memory do you want to give
	>>what are the resources does the container use (memory, CPU and ports)

>Task Definition: 
	>>it is a group of containers; 
	>>it contains the relationship amongst the containers
	>>task role:provides access to AWS services;when you need access to AWS services
	>>task execution IAM role:provides permissions to pull container images (present in docker registry in AWS) and publish container logs to
	Amazon CloudWatch

>Service: 
	>>allows you to run and maintain a specified number (the desired count) of tasks
	>>using this we can configure how many tasks are running
>Cluster:
	>>grouping of one or more container instances (EC2 instances, where the task is getting executed)
>Container Instance:
	>>EC2 instance in the cluster running a container agent that helps it to communicate with the cluster

Q. I want to deploy a new microservice using fargate or basic ECS. How do I go about it?
Ans. A couple of steps:
	>create a new task definition:
		>chose a launch type: fargate or ecs
		>choose the container: task definition
	>go inside a specific cluster and create a service using the task definition
	>select how many instances of the microservice you want

#############Points To Remember############################
>AWS Fargate does NOT give you visibility into the EC2 instances in the cluster
>On-Demand or Spot instances to create your cluster
>ALB can be used to load balance ECS instances through:
	>Dynamic host port mapping:multiple tasks from the same service are allowed on a single EC2 (container) instance
	>Path based routing: if multiple microservices are running as part of the cluster then a look up at the path can help in routing to the 	traffic to the corresponding microservice


#############Running Docker Containers in AWS
Remember
>Elastic Beanstalk
	>>allows to run single container or multiple containers in the same EC2 instance
	>>does not allow to create clusters
	>>basically take a container and run it as a web app (???)
	>>recommended for simple web apps
>Amazon Elastic Compute Service
	>>AWS specific solution for container orchestration
	>>Ideal for microservices
>Amazon Fargate
	>>Serverless version of Amazon ECS
	>>Running microservices and you don't want to manage the cluster
>Amazon EKS
	>>AWS managed services for Kubernetes
>Elastic Container Registry
	>AWS managed container registry that makes it easy for developers to store, manage and deploy container images
	>store for docker images
	>compresses, encrypt and controls access to images	
	>versions, tags and manage image lifecycles

#################AWS Lambdas

>AWS Lambda, Lambda Fn, Gateway
Serverless: Focus on the code and cloud would take care of provisioning, scalability,availability
>>World before Lambda: ELB with EC2 servers
>With AWS Lambda you pay only for:
	>number of requests
	>duration of requests
	>memory consumed
	>Java,Go,PowerShell,Node,C#,Ruby,Python
	>AWS Lambda fn can be triggerred from Amazon API Gateway
	>Price you pay for an AWS Lambda is directly proportional to the Memory allocated to AWS Lambda
	>900 seconds is the max timeout for an AWS Lambda fn while by default the timeout is 3 seconds
	>AWS lambda is not suitable for big batch jobs
	>By default, AWS lambda works in public network nut it can be made to run in private (through VPC)
	>Dead letter queue service is a way to ensure high availability in AWS Lambda

Q. How can you trace a lambda call to another lambda call (multiple lambda calls)?
Ans. Through AWS X-ray

Q. How do you assign permissions to a lambda function?
Ans. By creating or assigning role to the function through IAM console.

*********Remember for AWS Lambda
>Lambda is stateless so the state data has to be stored in S# or Amazin DynamoDB
>500 MB of non persistent disk space is given for AWS Lambda (/tmp/directory)

#####API Gateway fynctions: Amazon API Gateway
>authentication/authorization (securing)
>set limits for API consumers (publishing)
>implementing multiple versions of the API
>monitor API calls (monitor)
>API caching
>CloudFront helps to make APIs available across the world from edge locations (locations outside the region)

#################################################################################################################
Amazon Virtual Private Cloud
#################################################################################################################
>Own isolated n/w in cloud
>N/w traffic within VPC is isolated (not visible) from all other Amazon VPCs
>control incoming / outgoing traffic
>grouping of resources for security constraints (public/private resources)

Q. What is a subnet?
Ans. Every resource on cloud (DB,EC2) have their own access needs. So the resources are demarcated as:
	>private (not accessible to internet->private subnet)
	>public (accessible to internet->public subnet)
	>resources in public subnet can talk to resources in private subnet
Q. Which of the following are true?
Ans.
	>VPC is created in a region. (True)
	>Each subnet is created in an AZ. (True)
	>Number of subnets = number of AZs. (True)

Q. How do you identify resources on a network, i.e. whether it is a public or private resource?
Ans. IP Address

Q. What is CIDR?
Ans. Classless Inter-Domain Routing.
	>Starting IP Address + Range
	>69.208.0.0./28

>Every VPC is associated with a CIDR block.

Q. A CIDR block in a VPC can contain addresses from /16 (65536 IP addresses) to /28 (16 IP addresses). True or False.
Ans. True

>Internet Gateway has a one-to-one relationship with VPC.

>NAT Gateway should be preferred over NAT instance since the former is managed
>NAT Gateway supports IPV4
>NAT Gateway is created always in the public subnet and they need the Internet Gateway
>NAT Gateway can be set up in multiple AZs
>NAT Gateway mandatorily needs an Elastic IP address
>NAT instance can do with a public address too if elastic address is not configured
>NAT Gateway cannot be used as a bastion server (???)


############### Remember Qs / Ans VPC ####################################
Q. Can I have a VPC spread over two regions?
Ans. No

Q. Can I have multiple VPCs in the same region?
Ans. Yes

Q. The same default security group is assigned to a DB and an EC2 instance in a VPC? Can these two instances talk to each other?
Ans Yes. Default security group has a rule allowing traffic between resources with same security group. But if they are sharing a new security group configured by the user then the rule to allow traffic between resources with the same source has to be manually configured.

### Network Access Control List

>Security Group applies to a resource/instance whereas NACL applies only to subnets
>Security Group allows only "allow" rules whereas NACL allows both "allows" and "deny" rules
>Security Group is stateful (if inbound is allowed then outbound is automatically allowed) where as NACL is stateless
>Security Group rules are not prioritized whereas NACL rules are prioritized

Q. An EC2 instance cannot be accessed from the internet. What are the options that could possibly be true?
Ans. slide 127 section 11

#############Amazon Simple Storage Service S3 #####################################################
>key-value approach of storage hence also called 'object storage'
>serverless
>REST API to access/modify objects
>Unlimited storage
	>99.9% availability
	>11 9's durability (you would never lose data in S3)
	>data (objects) are replicated across multiple AZs in a single region
>supports all data type
	>media,archives,.pkg,.logs
>backup of DBs or storage devices
>staging data during on-premise to cloud DB migration
	>storing data to S3 from corporate data center and then to AmazonDB (this is called staging)
Q. What is a bucket?
Ans. It is the fundamental container in S3. Everything is stored in a bucket.

Q. S3 is a global service. Still you have to choose a region while creating bucket. Why?
Ans. Because buckets are associated wih a region.

>Remember, a bucket name cannot have an upper case character since the name is part of a url
>There is no hierarchy of buckets

>>>AWS Versioning
	>prevents against accidental deletion
	>disabled by default
	>cannot be turned off but can be suspended
	>all prev versions before versioning enabled are 'null'

Q. What are the security steps to host a static website at S3?
Ans. 
	>enable static website hosting
	>disable "block public access"
	>configure "Bucket policy" to enable public read access

#########Bucket policies 
	>are also known as resource based policies
	>control access to your buckets and objects
	>can grant cross account and public access

>S3 Object lock:
	>ensures that if a bucket (data) is not to be deleted at any cost it is definitely complied with immediately as the data is created
	>WORM:Write One Read Multiple
	>enabling object lock automatically enables versioning

>Transfer acceleration:
	>paid service
	>should be used only after a speed comparision


>Amazon Prefix: search objects

####Bucket ACLs and Object ACLS
	>Access for bucket/object owners
	>Access for other AWS accounts
	>Public access

Q. When to use Object ACLs (Object Level Access) in S3?
Ans. 
	>When bucket owner is not the object owner
	>When you need different permissions for different objects in the same bucket

####Remember Bucket/Object ACLs
	>cannot have conditions while policies can have conditions
	>cannot explicitly deny access
	>cannot grant permissions to other individual users
	>ACLs are primarily used to grant permissions to public or other AWS accounts

Q. What are storage class in S3?
Ans. Storage classes based on access/cost tradeoff.

Q. I want data to be frequently accessed. Which storage type should I opt for?
Ans. Standard. High Availability

Q. I want data to long-live but infrequently accessed. Which storage type should I opt for?
Ans. Standard-IA. High Availability

Q. I want data to long-live but infrequently accessed and non critical data. Which storage type should I opt for?
Ans. One Zone-IA. (example thumbnails for images, re-calculatable). Low availability since AZ is 1 only

Q. I want data that is long-lived but with changing or unknown access patterns. Which storage type should I opt for?
Ans. Intelligent Tiering. Here S3 decides the storage mechanism i.e., Standard or Standard IA based on access patterns.

Q. I want to store and archive data with retrieval time between minutes to hours. Which storage type should I go for?
Ans. Glacier.High Availability

Q. I want to store and archive data with retrieval time between hours to days. Which storage type should I go for?
Ans. Glacier Deep Archive. High Availability

Q. How do you save costs and move files automatically between storage classes?
Ans. Lifecycle configuration
	>Transition action (one storage class to another)
	>expiration action (delete action)

Q. YOu can replicate objects between buckets in same or different regions and accounts. True or False.
Ans. True provided versioning is enabled in both source and destination.

###########S3 Consistency Model###############################
	>S3 guarantees READ AFTER WRITE for PUTS of new objects: if you add a new object in a bucket then if you try to read the object again then S# guarantees that the object would be available
	>eventual consistency for overwrites PUTS and DELETES: when an existing object is being overwritten or deleted S3 guarantees that either 		the previous version or the latest version would definitely be returned

Q. What are pre-signed urls in S3 (Query String Authentication)?
Ans. 
	>Time limited permission to download objects
	>to avoid web site scraping and unintended access
	>created using AWS ADK API:
		GeneratePresignedUrlRequest(bucketName,objectKey).withMethod(HttpMethod.GET).withExpiration(expiration)		

##########Amazon S3 Access Points
>helps to simplify bucket policy configuration
>for apps spread across VPCs accessing S3 buckets needs a policy configuration
>these policies can be directly specified over access points
>provide multiple customized paths with unique hostname and access policy for each bucket

***Access points are to S3 what Security rules are to EC2. Remember!!!Eureka!! 
***Remember:Section 12: Slide 153 Quick review of Amazon S3 Security Scenarios

Q. What are the steps you would take as an AWS architect to reduce costs for your S3 storage strategy. Choose all that apply.
Ans. 
	>use proper storage classes
	>configure lifecycle management
	>analyze storage access patterns and decide the right storage class for my data (intelligent tiering, enable analytics on the bucket)
	>use lifecycle rules to move data automatically between the storage classes

Q. How do you remove objects from bucket after a specified time period?
Ans. Configure expiration policy through 'lifecycle rules' for the bucket

Q. As an AWS architect what are the steps you would take for improving the performance of S3 bucket?
Ans. 
	>Use prefixes
	>transfer acceleration
	>use multipart uplaod API
		>advantages: quick recovery from any n/w issues
		>pause/resume object uploads
		>use HTTP header : 'Range'
	>Try to avoid accessing the bucket from a different region (cost+latency issue)

>S3+S3 Batch : helps to change in bulk tags/metadata/ACLs for the bucket data in one go

Q. KBC:2020. If you are talking about vaults and archives in AWS, what are you talking about?
Ans. AWS S3 Glacier


########################AWS Database Migration Service #######################################
>AWS DB Migration Service helps in migrating on premise DB to cloud
>DB catalog service called:Glue
>S3,EFS,FSx:Storage
>AWS Data Sync agent has to run on premise to sync up with AWS Data Sync on cloud
>AWS Outposts : Bringing AWS on premise
>Amazon EMR on AWS Outposts

####Data Lakes : Modernize your Data Warehouse
>AWS Lake Formation: Builds data lakes securely
	>AWS Glue
	>Blueprints\
	>ML Transforms
	>Data Catalog
	>Access Control
>AWS AQUA: Query accelerator
>Amazon Athena:Interactive Query Service: Pay per query
>AWS File Gateway: a virtual or h/w appliance
	>utilizes a n/w file system to interface woth Amazon S3
	>used to populate your data lake
		>created data upload to S3 using file share

####################
Datacenter (apps) ----->NFS/SMB ----->AWS File Gateway ------>S3

>AWS Data Sync: online data transfer
	>virtual applance (AWS DataSync agent) ---->TLS---->AWS Data Sync

SFTP/FTPS/FTP :----->AWS Transfer Family

>Offline data ingest:AWS SnowFamily/AWS Snowmobile
	>Data transfer & edge compute
	>AWS OpsSnub:GUI for AWS Snowball Edge

Data ingestion:
	>AWS File Gateway, AWS Data Sync, Transfer Family, Sbow Family----->NFS/SMB/SFTP/FTP/FTPS

Q. What is a Data Lake?
Ans. Data lake is a central secured repository for data based on S3.

Q. What is a blueprint?
Ans. Template for comon igestion use cases. From this an AWS Glue Worklfows can be created
Q. Amazon Athena?
Ans. Analytics platform

> AWS EFS/AWS FSx : Business workloads data store
> AWS FSx: Windows File Server
	>fully managed
	>SMB protocol
	>build on windows server
	>compliant with Windows File System

> AWS ESx for Lustre
	>S3 datasets for POSIX file system
	>compute intensive workloads
	>



##################Data Encryption For AWS ###############################

Data States: 
	>At rest / In transit
	>In and Out of AWS
	>Within AWS
	
>Encryption
	>>Symmetric Key Encryption
		>Uses the same key for encryption and decryption
		>Challenges:
			>Right encryption algorithm
			>Securing the encryption key

	This works well for data at 'rest' that is in storage. But for data in 'motion' not only the encrypted data but also the encryption key needs to be shared/sent. But how?
			>Sharing the encryption key ??
	The answer is 	>>Assymetric key encryption.
	There are two keys: the Public and the Private Key
>AWS KMS : Key Management Service
>AWS Cloud HSM: Cloud Hardware Security Module : the above two deal with store, usage and replacement of the keys
	>Dedicated single tenant Hardware security module
	>AWS has no access to master keys hence the neeed to run HSM in multiple AZs as a fallback
>KMS uses 'envelope encryption' to encrypt data

Q. What is server side encryption?
Ans. 

############### Storage Types AWS EBS ##############################

>>>Block Storage
>1 block storage device can only be attached to one virtual server
>Creating a network of storage devices together for performance:SAN
>1---n relationship between block storage and virtual servers (1 BS can be mapped to a single virtual server)

>>>>File storage
	>sharing of files
	>n---n relationship between virtual servers and file storage


Q. EBS vs Instance Store?
Ans. When a virtual server (EC2) instance is deployed over the cloud the host computer where the EC2 is hosted has some internal storage which is called the 'Instance Store' also known as 'ephemeral store'. EBS is network storage and not tied to an EC2 instance.

>>>EBS
	>Attached as a network drive
	>PRovisioned capcity
	>replicted within same AZ
	>Independent lifecylce from EC2
	>size increase possible when attached to EC2 instance
	>Low boot up time

Q. Why is it not recommended to have ephemeral storage as primary storage?
Ans. It is temporary, high  boot up time.

>EBS volumes can be attached to EC2 instances in the SAME AZ only
>EBS vloumes can be created independently
>Root volumes cannot be detached while the instance is in active state
>To see all blocks in an EC2 instance:
	$lsblk

>Data on the EBS volumes is persistent even if it detached from instance or on termination of the instance

Q. I have a GPP SSD. And I want to increase the performance. How do I go about it?
Ans. Increase the size. 3 I/O operations per GB is the increase

FIFO and Standard Queue Processing

>In standard there is a parameter 'Visibility Timeout':0-12 hrs;default 30 seconds
> In FIFO, we can set 'deduplication'

>In long polling, the number of API calls would be less to the AWS and that increases the efficiency of the messaging; 'Receive message wait time' is the maximum amount of time that polling will wait for messages to become available tElastico receive'

>Types of EBS: Store Types
	>Provisioned IOPS/General Purpose SSD/Throughput Optmized HDD/Cold HDD

Q. How can you take a back up of Elastic Block Volumes?
Ans. Taking Encrypted
Not Encryptedsnapshots:
	>takes point-in-time snapshots of EBS vloumes (stored in S3)
	>snapshots are incremental hence older vols can be deleted
	>snapshots are constrained to the created region, hence to use in other regions we can copy it
>Encryption in EBS ensures:
	>encryption for data at rest
	>encryption for data in transit: EC2<--->EBS<---->Snapshots
	>ecnryption can be enabled at 3 places:
			>creation of EC2 instance:add storage step
			>creation of EBS volume
			>copying of snapshot (not creation of snapshot, by default there is no option for encryption, if volume from which snapshit 					is being taken is not encrypted)
			>copying AMI

Q. As an AWS architect what are the steps you would take to enhance the performance between EC2 and EBS? Choose all that apply.

Ans.
	>Launch EC2 instances as EBS optimized instances
	>Enhanced networking through Elastic Network Adapter (ENA)
	>Use Elastic Fabric Adapter : EFA = ENA + OS-bypass

Q. I can stop an EC2 instance created with an Instance Store. True or False.
Ans. False. Only EBS backed instance can be stopped or hibernated. Since in Instance Store everything is lost the moment EC2 instance is shut down.

#########Remember RAID: Redundant Array Of Independent Disks ###################
	>RAID 1:higher durability; higher fault tolerance; data present in multiple volumes/disks
	>RAID 0:higher performance; higher I/Ops; no duplication; low fault tolerance

>Amazon Data Lifecycle Manager: Amazon EBS snapshots lifecycle management

##################Amazon Kinesis #################################
Q. You need to design a system where in the real time data has to be processed. and the messages shall be available for 7 days. And you should be able to replay the data. How are you going to design the system?
Ans. AWS Kinesis.

>Each shard i/p ca be 1000 msgs per second and you can read 2MB per second
>Each shard will have unique id
>


##################Amazon RDS######################################
>Multi AZ deployment of DBs ensures no downtime but there is latency during switching
>Multi AZ does not help in improvement in scalability BUT read replica guarantees scalability since there is a separate instance to read records
>Automatic failover to standby from master is possible through 'CNAME' record flipping performed by AWS


##################Amazon Aurora
>MySQL and PostgreSQL compatible
>maintains 2 copies of each in a minimum of 3 AZ
>all the updates from master happen to cluster volume from wherein they reach the individual read replicas
>provides global database option
>upto 5 read only, secondary AWS regions
>Deployment Options:
	>single master (1 writer / multiple readers)
	>multi master (multiple writers)
	>serverless

##Scaling options for a Amazon RDS:
	>Vertical
		>change DB instance type and storage type
	>Horizontal
		>read replicas
		>Aurora (deployment types: single master or multi master)
>To monitor slow running queries 'Enhanced Monitoring' can be used

Q. You have a pre-defined schema. Strong transactional capabilities. Complex queries. Which DB should you use?
Ans. Amazon RDS

Q. You need a database with highly scalable massive read/write operations:millions of writes/second. Which is the database to go for?
Ans. Amazon Dynamo DB

Q. You need a full control of OS and/or elevated permissions. Which option you should go for?
	a. AWS RDS
	b. AWS Dynamo DB
	c. Custom installation (own EC2+EBS and DB installed manually over it)
Ans. c

Q. You want to migrate an on premise database to cloud database of the same type. How to go about it?
Ans. Use AWS Database Migration Service.

Q. How can you add encryption to an unecrypted Database?
Ans. 
	>Create a DB snapshot
	>Encrypt the database snapshot using keys from KMS
	>Create a database from the encrypted snapshot

Q. How can you manage different DB connection pools?
Ans. Amazon RDS Proxy

################Indexes and other things in Amazon Dynamo DB
>Max size of an item in DynamoDB is 400KB
>For larger items they have to be stored in S3	
>Primary Key:
	Partition Key + Sort Key
	Partition key is used to distribute data across different partitions since DynamoDB is by default distributed	
>Indexes are not free
>To query on any other key than partition key we need to create an index on it
>There are two types of indexes
	>Local Secondary Index
		>Same partition key as primary key but a different sort key
		>stored locally with the table
	>Global Secondar Index
		>Partition and sort key different from primary key
		>stored separately
>Amazon Dynamo DB supports transactions but they are expensive
>Provisioned RCU is always less expensive than On Demand RCU

Q. What is used for performance monitoring in AWS Dynamo?
Ans. Cloudwatch
Q. How do you automatically delete items in Amazon Dynamo DB?
Ans. TTL

Q. What is DAX?
Ans. In-Memory caching for DynamoDB. Instead of consuming RCUs data can be read from DAX. Recommended only for read intensive and loosely consistent databases.

##############Amazon ElastiCache
>Managed service 
>Highly scalable
>Low latency
>In-Memory data store
>Two options
	>Redis: in - memory, persistent datastore
	>Memcached: pure cache

Q. What is a shard?
Ans. A collection of one or more nodes. One node acts as a read/write primary. Other nodes act as read replicas (upto 5 read replicas)
	>back up in S3 is possible
	>snapshots is available and can be scheduled
	>encryption is supported




###############AWS Route 53
>Domain Registration + DNS
Standard DNS Records:
>A --->Name to IPV4 addresses
>AAAA ----->Name to IPV6 addresses
>NS ------>Name Server containing DNS records
>MX ----->Mail Exchange
>CNAME ---->from one DNS name to another DNS name

Q. If you want to route traffic to a selected AWS resource?
Ans. We have to use alias records.

Q. What is a hosted zone?
Ans. A container for DNS records routing traffic to a specific domain
	>private
	>public
Q. What is a DNS record?
Ans. Specifies a name server

vpc-3e7c6056 | Mumbai | ap-south-1 | 13.232.133.177
vpc-08352b72 | US East 1 | us-east-1 | 100.24.74.141
vpc-26c31c4c | Frankfurt | eu-central-1 18.194.243.182
vpc-af9184c8 | Sao Paulo | sa-east-1 | 18.228.170.114


#####################################################################
Applications with SQS, SNS and MQ

SQS: Push Model
Two types of Queue
Standard Queue and FIFO Queue
##Standard Queue
	>Unlimited throughput
	>Definite delivery
	>Multi times processing
	>Best effort ordering
	
##FIFO Queue
	>FIFO
	>Exactly once processing
	>Lower throughput
	
Q. I have throughput important, which queue should I opt for in my application?
Ans. Standard Queue

Q. I have order of events being processed important, which queue should I opt for in my application?
Ans. FIFO

Q. How do you implement autoscaling in SQS?
Ans. CloudWatch Alarm listening on specific configuration on the queue for example the number of messages on the queue, which would create
alarm and the auto scaling group policy would take care to scale up / down the EC2 instances processing the messages hosted by the SQS

Q. How do you grant access to an SQS queue?
Ans. >Using IAM roles (for queue owners)
	 >Configure SQS Queue Access Policy to provide access to other AWS accounts
	 
####AWS SNS
Publish-Subscribe paradigm
>Broadcast
>Pub-Sub mechanism

Q. Make a web-app/app/ API to send push notifications to users about what the day it is.

###Amazon MQ
	>Managed message broker service for Apache Active MQ
	>Amazon MQ = AWS SQS + AWS Topic
	>Stepping stone to migrate on-premise applications using traditional message brokers
	>Next step: redesign to use SQS and SNS
	
	
##Routing and Content Delivery
Q. How do you enable serving content directly from AWS Edge locations?
Ans. Amazon CloudFront
Use cases: static webapps/video/audio downloads
>supports media streaming

Q. How to distribute your content to edge locations?
Ans. In the below steps:
		>DNS domain name
		>Origins (S3, EC2, ELB, external website)
		>Cache-Control
		
##############VPC Peering Connecting AWS With On Premise Data Centers
VPC Peering: Connect VPCs to same or different accounts irrespective of the regions of the VPCs
>Allows private communication between the connected VPCs
>Peering would use a 'request' accept protocol
>Peering is not transitive

Q. When do you go for a VPC Endpoint?
Ans.When you want the traffic not to go through the internet.
	>Gateway Endpoint: connect to S3/DynamoDB
	>Interface Endpoint: connect to other services except S3/DynamoDB (ENI is reqd)
	
VPC Endpoint: A secured tunnel using IPSec over internet to connect to customer gateway
				>IP Routable table is present on the customer gateway side
				
AWS Direct Connect:
>private
>dedicated
>reduced ISP B/W cost
>Better performance
>connection takes a long time to establish connection
>No encryption of data by default

Note: if a customer wants to manage both sides of VPN then Software VPN is the solution			

#############Moving Data From On Premises to AWS
###S3 Transfer Accleration
>Most basic way to transfer data (upload/download)
>Transfers possible from edge location
>Have to enable S3 acceleration end points
>Uses Amazon CloudFront to transfer the data

###AWS Snowball
>Physical shipping of the data
>Huge amount of data transfer is possible
>Fits for cases where a direct transfer would take weeks
>Preferred for locations where internet connectivity is a problem

###AWS Snowmobile
>Big Brother of AWS Snowball
###AWS DataSync
>Custom software to transfer on premise data to cloud

########AWS Database Migration Service
>migrating databases while operational
>continuous data replication
>consolidate multiple databases into a single target database

########AWS Schema Conversion Tool
>Migrate data from commercial databases and data warehouses to open source or AWS Services
>AWS SCT : preferred tool to DB schemas to Amazon Redshift
>SCT is a part of AWS DB Migration Service
>SCT is used only in case of heterogeneous schema

##########AWS DevOps
Codecommit, Codepipeline, Codebuild, Codedeploy

##IAAC DevOps
Create Template-->Provision Server---->Install Software----->Configure Software----->Deploy App
>Infra changes are tracked over version control
>Infra is treated as a s/w code
>Repeatability of infrastructure

2 key parts of IAAC:
	>Infra provisioning:
		>provisioning compute, DB, storage, n/w
		Tools for infra provisioning:
			>Open source cloud neutral:Terraform
			>AWS: CloudFormation
	>Configuration management:
		>is installing right software and tools on the provisioned resources
			>Open source tools: Chef, Puppet, Ansible
			>AWS: OpsWorks: Built around Chef+puppet

>AWS CloudFormation: tool for IAAC
	>Needs a template: .json or .yml
	>Stack of resources
	>Change sets (changes to the template)
			

###########AWS Shield
>AWS WAF: AWS Web Application Framework
>AWS Shield: DDoS attacks

########AWS Organizations
>Creating multiple accounts
>organize all accounts into a single organization
>centralized billing for all AWS accounts
>centralized mgmt of rules through AWS ConfigRules
>centralized log mgmt through CloudTrail data being sent to a single S3 bucket
>single firewall rules through AWS Firewall Manager to manage firewall rules


##############AWS Directory Service
>AWS Directory Service for Microsoft AD
>Simple AD
>AD Connector (most common for on premise diretory services)

########AWS Global Accelerator
>Directs traffic to optimal endpoints over the AWS Global Network

#########Video Processing Services
>AWS Elemental MediaConvert (MPEG-2,AVC,Apple ProRes, HEVC)
>AWS Elastic Transcoder (WebM Video, MP3 audio, Animated GIF files)
>AWS Elemental Media Live (live videos)

####Amazon Macie
>Uses AI to auto detect sensitive data in S3 buckets


###AWS Workspaces
Desktop as a service

####AWS Secrets Manager
>Secret Mgmt
>Rotates secrets automatically without impacting applications

########AWS Simple Workflow Service
>Build or run background jobs asynchronously or synchronously
>a possible replacement for ROSE/OSM

######AWS SSO


####AWS Costs and Monitoring : Udacity Nanodegree Notes
https://bluesentryit.com/gain-real-savings-proper-cloud-setup/

